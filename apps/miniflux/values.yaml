# Miniflux RSS Reader values for homelab
# Uses CloudNativePG for database instead of bundled PostgreSQL

# Disable bundled PostgreSQL - we use CNPG instead
postgresql:
  enabled: false

# Environment variables for Miniflux
env:
  # Database connection - uses secret auto-generated by CNPG
  # The operator creates a secret named [cluster-name]-app with connection details
  DATABASE_URL:
    valueFrom:
      secretKeyRef:
        name: miniflux-db-app
        key: uri

  # Run database migrations automatically
  RUN_MIGRATIONS: "1"

  # Base URL for the application
  BASE_URL: "http://miniflux.homelab"

  # ============================================================
  # ADMIN CREDENTIALS - UNCOMMENT AFTER CREATING SEALED SECRET
  # ============================================================
  # Follow the kubeseal instructions in this directory's README,
  # then uncomment these lines and update miniflux.yaml to include
  # admin-secret.yaml in the directory include pattern.
  #
  CREATE_ADMIN: "1"
  ADMIN_USERNAME:
    valueFrom:
      secretKeyRef:
        name: miniflux-admin
        key: ADMIN_USERNAME
  ADMIN_PASSWORD:
    valueFrom:
      secretKeyRef:
        name: miniflux-admin
        key: ADMIN_PASSWORD

# Ingress configuration using Traefik (k3s default)
ingress:
  main:
    enabled: true
    className: traefik
    annotations:
      traefik.ingress.kubernetes.io/router.entrypoints: web
    hosts:
      - host: miniflux.homelab
        paths:
          - path: /
            pathType: Prefix

# Service configuration
service:
  main:
    ports:
      http:
        port: 8080

# Resources - homelab friendly
resources:
  requests:
    memory: 32Mi
    cpu: 10m
  limits:
    memory: 128Mi
    cpu: 100m
